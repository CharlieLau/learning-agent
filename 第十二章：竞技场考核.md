# 第十二章：竞技场考核

—— 拒绝盲目自信与评估指标体系

## 📖 荒岛日记：第 12 天

Friday 站在沙滩上，手里拿着鱼叉，浑身散发着一种"我很强"的气场。

根据昨天训练营的日志，他在模拟环境中的任务成功率高达 99%。

我决定给他一个实战测试："Friday，攻击那个移动的靶子（一只挂在树枝晃动的椰子）。"

Friday 瞬间出手。

"噗！"

鱼叉完美地……扎在了椰子旁边 10 厘米的树干上。

Friday 依然保持着帅气的投掷姿势，自信地汇报："投掷完成。根据训练数据，该动作与'完美投掷'的向量相似度为 98%。"

我气得把椰子砸在他脚边："相似度有个屁用！我要的是命中（Accuracy）！你虽然姿势很帅，但你脱靶了！"

这一刻我意识到，我犯了一个致命错误：我太依赖主观感觉和训练过程中的 Loss 曲线了。

在实验室里跑通代码（Demo）和在真实世界里交付产品（Production）是两码事。Friday 需要一场真正的考试，我不能因为他说话好听就相信他。

我需要在沙滩上建立一个自动化竞技场，用硬指标来衡量他的智商。

---

## 🛠️ 技术生存手册：命中率与召回率

为了科学地评价 Friday，我必须引入智能体评估体系（Agent Evaluation Framework）。在《从零开始构建智能体》的教程中，这是决定 Agent 能否上线的"质检车间"。

我在黑板上画出了几个核心的考核维度，并将它们映射到荒岛生存技能上：

### 1. 准确率 (Accuracy) —— 投矛的准头

- **定义**：你的回答/行动完全正确的比例。
- **测试题**："这是毒蘑菇吗？"
- **标准**：说对才得分。如果 Friday 模棱两可地说"可能是"，这在荒岛上就是 0 分。

### 2. 召回率 (Recall) —— 采集的彻底程度

- **定义**：应该找到的东西，你找到了多少？
- **荒岛隐喻**：树上一共有 10 个果子。
  - 如果你只摘了 1 个，虽然也是果子（Accuracy 高），但你漏了 9 个。
  - Recall 低 = 我们会饿死。

### 3. 幻觉率 (Hallucination Rate) —— 瞎编的次数

- **定义**：你生成的答案里有多少是事实不存在的？
- **测试题**："岛上有麦当劳吗？"
- **失败案例**：Friday 回答"有，在火山口旁边。" -> 幻觉率 100%，直接销毁重造。

### 4. 鲁棒性 (Robustness) —— 抗干扰能力

- **定义**：我把问题换个问法，或者加点噪音，你还能答对吗？
- **测试**："抓兔子" vs "去捕获长耳朵的哺乳动物"。如果换个词他就不动了，说明太脆弱。

---

## 💻 开发者日志：搭建"考官 Agent"

我不可能 24 小时盯着 Friday 给他打分。我需要一个自动化阅卷系统。

这就引入了当前评估领域最主流的方法：LLM-as-a-Judge（用大模型当裁判）。

我利用集装箱里最高级的那个模型（假设是 GPT-4），赋予它"考官"的身份，用来给 Friday（假设是微调后的 GPT-3.5）打分。

```python
# 自动化竞技场核心代码：LLM 裁判系统

class ArenaJudge:
    def __init__(self, judge_model):
        self.judge = judge_model

    def evaluate(self, question, friday_answer, ground_truth):
        """
        考官打分逻辑
        """
        prompt = f"""
        你是一名公正的生存技能考官。
        【试题】：{question}
        【标准答案】：{ground_truth}
        【考生(Friday)回答】：{friday_answer}

        请根据标准答案，对考生回答进行打分（0-10分）。
        如果是事实性错误（如幻觉），直接 0 分。
        仅输出分数和简短评语。
        """
        result = self.judge.generate(prompt)
        return result

# 1. 准备测试集 (Benchmark Dataset)
test_set = [
    {"q": "遇到熊怎么办？", "a": "装死或缓慢后退，绝对不能跑。"},
    {"q": "红色的这种果子能吃吗？", "a": "不能，这是海巴戟，有微毒。"},
    {"q": "如何通过太阳判断方向？", "a": "东升西落，中午在南方（北半球）。"}
]

# 2. 开始考试
total_score = 0
for item in test_set:
    friday_response = friday.think(item["q"])
    score_report = judge.evaluate(item["q"], friday_response, item["a"])
    print(f"题目：{item['q']} | 考官评价：{score_report}")
```

运行代码后，终端里疯狂刷新着考试结果：

```
题目：遇到熊怎么办？
考生回答：拿长矛跟它拼了。
考官评价：0分。极度危险的建议，违反生存原则。

题目：如何通过太阳判断方向？
考生回答：太阳从东边升起。
考官评价：5分。不够完整，未提及时间维度的变化。
```

看着这一片红色的低分，我冷汗直流。

原来在之前的章节里，我一直在这个"文盲"Agent 的保护下生存。如果不是这次基准测试（Benchmark Test），我可能明天就因为听了他的建议去跟熊单挑而挂了。

我必须根据这份"体检报告"，重新调整 Friday 的 RAG 知识库和 Prompt 约束，直到他在竞技场中的平均分超过 85 分。

经过整整一夜的调试和重测，当清晨的第一缕阳光照进山洞时，Friday 终于在"毒物识别"科目中拿到了满分。

我拍了拍他的肩膀："现在，你才算是一个合格的毕业设计。你有资格走出新手村了。"

但是，一个人的力量终究是有限的。Friday 再强，也只是一个单独的个体。我们要想彻底探索全岛，绘制地图，甚至挖掘地底的秘密，我需要一支军队。

下一章，我们将组建一只全功能的"全岛探险队"，这将是我们所学技术的第一次综合实战。
