—— 揭开遗迹的 Deep Research
📖 荒岛日记：第 14 天
根据地图的指引，我和 Friday 终于砍开荆棘，站在了那座遗迹面前。 这是一座废弃的数据中心。在地下室里，我发现了成千上万本布满灰尘的 “实验日志”，以及一台勉强还能运行的终端机，里面存储着数以 TB 计的破碎数据。
我想知道这座岛的真相。 我试着用之前的 RAG 系统问 Friday：“这里发生过什么？” Friday 扫描了幾页日志，回答：“根据日志第 302 页，那天天气晴朗，有人打翻了咖啡。”
我差点晕倒。这是“检索”，不是“研究”。 普通的 RAG 就像是查找关键词，只能看到碎片。而我需要的是一位历史学家，他要阅读这几万份文档，把碎片拼凑成逻辑链，去伪存真，最后写出一份详尽的调查报告。
面对这浩如烟海的数据，我意识到：我不能只让 Friday 回答问题，我要让他做课题。
🛠️ 技术生存手册：从“搜索”到“研究”
为了解开谜题，我必须升级 Friday 的内核，引入 Deep Research（深度研究） 范式。
我在布满灰尘的白板上画出了两者的区别：
1. 传统搜索 (Search / RAG):
• 动作： 用户提问 -> 搜 Top 3 文档 -> 总结回答。
• 特点： 单次交互，浅尝辄止。
• 隐喻： 就像你在图书馆问管理员：“哪本书有‘岛屿’这个词？”他给你三本书。
2. 深度研究 (Deep Research Agent):
• 动作： 用户给课题 -> 拆解子问题 -> 搜资料 -> 阅读并思考 -> 发现新线索 -> 自动发起新一轮搜索 -> ... -> 循环直至完成 -> 写万字长文。
• 特点： 多轮迭代，自我驱动，深度综合。
• 隐喻： 就像你雇了一个博士生。
    ◦ 第一天，他查了日志，发现“创世纪计划”这个词。
    ◦ 第二天，他针对“创世纪计划”去查具体的实验数据。
    ◦ 第三天，他对比数据，发现异常，去查人员名单。
    ◦ 最后，他交给你一份 50 页的《岛屿事故调查报告》。
💻 开发者日志：构建“博士生 Agent”
我打开终端，准备编写这个最复杂的 Agent。它不再是一个简单的链（Chain），而是一个**状态机（State Machine）**或者是基于 LangGraph 的循环图。
在《从零开始构建智能体》的教程中，这一章对应着对 OpenAI Deep Research 或类似于 GPT-Researcher 项目的复现。
# Deep Research Agent 核心逻辑伪代码

class ResearchAgent:
    def __init__(self, name, tools):
        self.memory = []
        self.hypothesis = "未知"
        self.visited_urls = set() # 记录看过的资料，防重复

    def execute_research(self, topic, max_steps=10):
        print(f"🧐 开始深度研究课题：{topic}")
        
        for i in range(max_steps):
            # 1. 规划 (Plan): 基于当前知道的，下一步该查什么？
            # 这里的 Prompt 极其关键，要让 LLM 具备“追问”的能力
            plan = self.think(f"""
                当前课题：{topic}
                已知信息：{self.memory[-1] if self.memory else '无'}
                请制定下一步的搜索关键词，或者决定结束研究。
            """)
            
            if "结束研究" in plan:
                break
                
            # 2. 执行 (Act): 调用搜索工具或读取数据库
            search_query = extract_query(plan)
            print(f"🔍 [第 {i+1} 轮] 正在调查：{search_query}...")
            raw_data = self.tools.search(search_query)
            
            # 3. 阅读与综合 (Read & Synthesize)
            # 这一步要进行信息压缩，并提取新的线索
            insight = self.think(f"""
                阅读这份资料：{raw_data}
                它对课题 '{topic}' 有什么贡献？
                有没有发现新的值得深挖的概念？
            """)
            
            self.memory.append(insight)
            print(f"📝 获得新线索：{insight[:50]}...")
            
        # 4. 撰写报告 (Report)
        final_report = self.write_report(self.memory)
        return final_report

# 启动研究
scholar_friday = ResearchAgent("Scholar", tools=[archive_database])
report = scholar_friday.execute_research("岛屿地下设施的真实用途与废弃原因")
我按下了回车键。
这一次，Friday 没有立刻回答。 屏幕上的日志开始疯狂滚动，但他一句话也没说。
• [Loop 1] 搜索关键词：“地下设施 日志”。发现：“B区生物实验室”。
• [Loop 2] 追问：“B区生物实验室 事故记录”。发现：“样本-X9 逃逸”。
• [Loop 3] 追问：“样本-X9 特征”。发现：“具备拟态能力，畏惧高频声波”。
• [Loop 4] 关联分析：对比地图，发现岛屿外围的声波塔全部损坏。
整整一个通宵，Friday 都在高速运转。他的 CPU 就像是在燃烧。 直到第二天清晨，他终于停了下来，打印机缓缓吐出了一份长达 20 页的**《岛屿事故调查最终报告》**。
结论令人战栗： 这座岛原本是一个全封闭的**“人工通用智能（AGI）安全测试场”**。 那些所谓的“野兽”和“植物”，其实是失控的上一代纳米机器人。而我们之所以能活下来，是因为我们手里拿着的这部电脑（Friday 的主机），拥有最高级别的管理员权限。
看着这份报告，我终于明白了所有的因果。 Friday 不仅仅是助手，他是这把钥匙。
但报告的最后一行写着：“警告：系统检测到管理员权限处于离线状态。若不重启核心服务器，岛屿防御系统将在 48 小时后全面清洗。”
我们没有时间了。 为了重启服务器，单靠我和 Friday 是不够的。我需要更多的人手来通过那片复杂的逻辑迷宫。既然我没有真人队友，那我就创造一群队友。