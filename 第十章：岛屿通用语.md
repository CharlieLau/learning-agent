# ç¬¬åç« ï¼šå²›å±¿é€šç”¨è¯­

**æ ¸å¿ƒä¸»é¢˜**ï¼šMCP åè®®ä¸æ™ºèƒ½ä½“é€šä¿¡

---

## ğŸ“– Day 10: è®¾å¤‡é€šä¿¡å¤±è´¥äº‹ä»¶

**é—®é¢˜ç°åœº**ï¼š
```bash
$ ./friday --connect weather_station

Friday: "äº²çˆ±çš„çƒä½“å…ˆç”Ÿï¼Œè¯·é—®æ˜æ—¥é™æ°´æ¦‚ç‡å‡ ä½•ï¼Ÿ"

Device: [æ— å“åº”]

Friday (English): "Dear sphere, what about tomorrow's rain?"

Device: "å“”â€”â€” ERROR: è¾“å…¥æ ¼å¼éæ³•"

Root Cause: è¯­è¨€ä¸åŒ¹é…ï¼ˆè‡ªç„¶è¯­è¨€ vs ç»“æ„åŒ–æŒ‡ä»¤ï¼‰
```

**é—®é¢˜è¯Šæ–­**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å·´åˆ«å¡”é—®é¢˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  Friday (è‡ªç„¶è¯­è¨€) â†Ã—â†’ Device (API Schema) â”‚
â”‚                                            â”‚
â”‚  Friday: "ä½ å¥½ï¼Œèƒ½å¸®æˆ‘æŸ¥å¤©æ°”å—ï¼Ÿ"           â”‚
â”‚  Device: {"cmd":"GET","path":"/weather"}   â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯è§£æ

### N x M é—®é¢˜

**æ— åè®®çš„æ··ä¹±ä¸–ç•Œ**ï¼š
```
Friday â”€â”€â”¬â”€â”€> æ°”è±¡çƒ (JSON API)
         â”œâ”€â”€> æ™ºèƒ½æ‰‹è¡¨ (Binary Protocol)
         â”œâ”€â”€> é—¨é” (Modbus)
         â””â”€â”€> æ— äººæœº (MAVLink)

æ¯ç§è®¾å¤‡éƒ½è¦å†™ä¸€ä¸ª Adapter â†’ çˆ†ç‚¸å¼å¤æ‚åº¦
```

### MCP åè®®æ¶æ„

**MCP = Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MCP ç»Ÿä¸€æ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Friday  â”‚ â†â”€â”€â”€â†’  â”‚ MCP Hub â”‚               â”‚
â”‚  â”‚ (Client)â”‚         â”‚         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
â”‚                           â”‚                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                    â”‚             â”‚             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â†“â”€â”€â”€â”€â”        â”‚
â”‚              â”‚ MCP Serverâ”‚ â”‚MCP Serverâ”‚        â”‚
â”‚              â”‚ æ°”è±¡çƒ    â”‚ â”‚ æ— äººæœº   â”‚        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                  â”‚
â”‚  åŸåˆ™: ä¸€æ¬¡å®ç°ï¼Œåˆ°å¤„è¿æ¥                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MCP æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | åŠŸèƒ½ | ç±»æ¯” |
|------|------|------|
| **Resources** | æ•°æ®æš´éœ² | "æˆ‘æœ‰ä»€ä¹ˆ" |
| **Prompts** | å»ºè®®æ¨¡æ¿ | "æ€ä¹ˆé—®æˆ‘" |
| **Tools** | å¯æ‰§è¡Œå‡½æ•° | "æˆ‘èƒ½å¹²ä»€ä¹ˆ" |

---

## ğŸ’» å®ç°æ–¹æ¡ˆ

### MCP Server å®ç°

```python
# mcp/weather_server.py

from typing import Dict, Any

class WeatherMCPServer:
    """
    æ°”è±¡ç«™ MCP æœåŠ¡å™¨
    å°†ç¡¬ä»¶æ¥å£åŒ…è£…æˆ MCP åè®®
    """

    def __init__(self, device_id: str):
        self.device_id = device_id
        self._connect_hardware()

    def list_resources(self) -> list:
        """
        æš´éœ²èµ„æºï¼šå‘Šè¯‰ Agent æˆ‘æœ‰ä»€ä¹ˆæ•°æ®
        """
        return [
            {
                "uri": f"weather://{self.device_id}/current",
                "name": "å½“å‰å¤©æ°”æ•°æ®",
                "description": "æ°”æ¸©ã€æ¹¿åº¦ã€æ°”å‹å®æ—¶æ•°æ®",
                "mime_type": "application/json"
            },
            {
                "uri": f"weather://{self.device_id}/forecast",
                "name": "å¤©æ°”é¢„æŠ¥",
                "description": "æœªæ¥ 24 å°æ—¶é¢„æµ‹",
                "mime_type": "application/json"
            }
        ]

    def list_tools(self) -> list:
        """
        æš´éœ²å·¥å…·ï¼šå‘Šè¯‰ Agent æˆ‘èƒ½åšä»€ä¹ˆ
        """
        return [
            {
                "name": "get_weather",
                "description": "è·å–å½“å‰å¤©æ°”æ•°æ®",
                "input_schema": {
                    "type": "object",
                    "properties": {
                        "location": {
                            "type": "string",
                            "description": "ä½ç½®ä»£ç "
                        }
                    },
                    "required": ["location"]
                }
            },
            {
                "name": "get_forecast",
                "description": "è·å–å¤©æ°”é¢„æŠ¥",
                "input_schema": {
                    "type": "object",
                    "properties": {
                        "hours": {
                            "type": "integer",
                            "description": "é¢„æµ‹å°æ—¶æ•°"
                        }
                    }
                }
            }
        ]

    def call_tool(self, name: str, arguments: Dict[str, Any]) -> Any:
        """
        æ‰§è¡Œå·¥å…·è°ƒç”¨
        """
        if name == "get_weather":
            return self._hardware_read_current(arguments["location"])
        elif name == "get_forecast":
            return self._hardware_read_forecast(arguments.get("hours", 24))
        else:
            raise ValueError(f"æœªçŸ¥å·¥å…·: {name}")

    def _connect_hardware(self):
        """è¿æ¥åº•å±‚ç¡¬ä»¶"""
        # å®é™…ç¡¬ä»¶è¿æ¥é€»è¾‘
        pass

    def _hardware_read_current(self, location: str) -> dict:
        """è¯»å–å½“å‰æ•°æ®"""
        # æ¨¡æ‹Ÿç¡¬ä»¶è¯»å–
        return {
            "temperature": 32,
            "humidity": 75,
            "pressure": 1005,
            "location": location
        }

    def _hardware_read_forecast(self, hours: int) -> list:
        """è¯»å–é¢„æµ‹æ•°æ®"""
        # æ¨¡æ‹Ÿç¡¬ä»¶è¯»å–
        return [
            {"time": "+2h", "condition": "é›·æš´"},
            {"time": "+4h", "condition": "å¤šäº‘"}
        ]
```

### MCP Client é›†æˆ

```python
# mcp/client.py

class MCPClient:
    """
    Friday çš„ MCP å®¢æˆ·ç«¯
    è‡ªåŠ¨å‘ç°å¹¶è¿æ¥ MCP è®¾å¤‡
    """

    def __init__(self, agent):
        self.agent = agent
        self.connected_servers = {}

    def connect(self, server: WeatherMCPServer):
        """
        è¿æ¥åˆ° MCP Serverï¼Œè‡ªåŠ¨å­¦ä¹ èƒ½åŠ›
        """
        server_name = server.__class__.__name__

        # 1. è·å–å·¥å…·åˆ—è¡¨
        tools = server.list_tools()

        # 2. æ³¨å†Œåˆ° Agent
        for tool in tools:
            self.agent.register_tool(
                name=tool["name"],
                schema=tool["input_schema"],
                handler=lambda args, s=server, n=tool["name"]: s.call_tool(n, args)
            )

        self.connected_servers[server_name] = server
        print(f"[MCP] å·²è¿æ¥: {server_name}")
        print(f"[MCP] ä¹ å¾—å·¥å…·: {[t['name'] for t in tools]}")

# ä½¿ç”¨
client = MCPClient(friday)
client.connect(WeatherMCPServer("ball_x1"))
```

### å®æˆ˜éªŒè¯

```bash
$ python mcp_demo.py

[MCP] å·²è¿æ¥: WeatherMCPServer
[MCP] ä¹ å¾—å·¥å…·: ['get_weather', 'get_forecast']

# Friday è‡ªåŠ¨å­¦ä¼šäº†ä½¿ç”¨æ°”è±¡ç«™
User: "æŸ¥è¯¢å½“å‰å¤©æ°”"

Friday (å†…éƒ¨):
  1. è¯†åˆ«æ„å›¾ â†’ get_weather
  2. ç”Ÿæˆå‚æ•° â†’ {"location": "island_center"}
  3. è°ƒç”¨ MCP â†’ call_tool("get_weather", {...})
  4. è§£æç»“æœ â†’ æ ¼å¼åŒ–è¾“å‡º

Friday: "å½“å‰æ°”æ¸© 32Â°Cï¼Œæ¹¿åº¦ 75%ï¼Œæ°”å‹ 1005hPaã€‚
          é¢„è®¡ä¸¤å°æ—¶åæœ‰å¼ºé›·æš´ï¼Œå»ºè®®æå‰é¿é›¨ã€‚"

Performance:
- é›¶æ‰‹å†™ä»£ç 
- è‡ªåŠ¨å‘ç°å·¥å…·
- æ ‡å‡†åŒ–é€šä¿¡
```

---

## æ¶æ„ä¼˜åŠ¿

| ç»´åº¦ | æ—  MCP | æœ‰ MCP |
|------|--------|--------|
| **æ¥å…¥æ–°è®¾å¤‡** | æ‰‹å†™ Adapter | **è‡ªåŠ¨è¯†åˆ«** |
| **ä»£ç å¤ç”¨** | ä½ | **é«˜** |
| **ç»´æŠ¤æˆæœ¬** | é«˜ | **ä½** |
| **æ‰©å±•æ€§** | å—é™ | **å¼º** |

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

**å½“å‰è¿›å±•**ï¼š
- âœ“ è®°å¿†å‹ç¼©ï¼ˆç¬¬ä¹ç« ï¼‰
- âœ“ MCP åè®®ï¼ˆæœ¬ç« ï¼‰

**æ–°é—®é¢˜å‘ç°**ï¼š
- Friday èƒ½åŠ›å¢å¼ºä½†ç¼ºä¹åˆ¤æ–­
- éœ€è¦å¥–æƒ©æœºåˆ¶
- éœ€è¦ä»·å€¼è§‚è®­ç»ƒ

**ä¸‹ä¸€æ­¥ä»»åŠ¡**ï¼š
- [ ] ç¬¬åä¸€ç« ï¼šå¼ºåŒ–å­¦ä¹ 
- [ ] ç¬¬åä¸€ç« ï¼šå¥–æƒ©æœºåˆ¶
- [ ] ç¬¬åä¸€ç« ï¼šä»·å€¼è§‚å¯¹é½

---

## ç³»ç»Ÿæ›´æ–°

```bash
$ git commit -m "feat: add MCP protocol support"

CHANGES:
- æ–°å¢ MCP Server åŸºç±»
- å®ç° MCP Client
- è‡ªåŠ¨å·¥å…·å‘ç°æœºåˆ¶
- æ°”è±¡ç«™é›†æˆ

VERSION: 0.9.0
STATUS: Friday ç°åœ¨èƒ½è¿æ¥ä»»ä½•è®¾å¤‡ï¼Œä½†éœ€è¦é“å¾·çº¦æŸ
```

---

**â†’ [ç¬¬åä¸€ç« ï¼šç‰¹ç§å…µè®­ç»ƒè¥](./ç¬¬åä¸€ç« ï¼šç‰¹ç§å…µè®­ç»ƒè¥.md)**
