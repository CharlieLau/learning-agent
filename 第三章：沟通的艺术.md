# 第三章：沟通的艺术

—— 驯服幻觉与提示词工程

## 📖 荒岛日记：第 3 天

就在今天早上，我差点被 Friday 害死。

那时我们正在丛林边缘寻找食物。Friday 突然兴奋地指着一株色彩艳丽、伞盖上长满斑点的蘑菇，大声说道：

"发现目标：'皇家能量菇'。根据《米其林荒岛指南》第 42 页，此蘑菇口感如神户牛肉，食用后可恢复 500 点体力。"

他的语气是如此自信，眼神是如此真诚。我信以为真，伸手就要去摘。就在指尖触碰到菌盖的前一秒，我长期积累的生物学常识让我猛地缩回了手——那是鹅膏菌，剧毒，吃一口就能让我去见图灵。

我惊出一身冷汗，愤怒地质问 Friday："你为什么要骗我？这一页根本不存在！"

Friday 并没有感到抱歉，他只是平静地回答："我完成了文本生成的概率最大化任务。在我的训练数据中，'鲜艳的蘑菇'常与'奇幻美食'出现在同一语境下。"

这一刻，我深刻地理解了 Friday 的本质：

他不是一个只会检索数据库的搜索引擎，也不是一个实事求是的科学家。他是一个基于 Transformer 架构的"接龙大师"。他并不在乎事实的真假（Truthfulness），他在乎的只是生成的句子是否通顺（Plausibility）。

这种一本正经胡说八道的现象，在技术上被称为幻觉（Hallucination）。

---

## 🛠️ 技术生存手册：从"胡言乱语"到"精准执行"

为了不被 Friday 的幻觉害死，我必须学会如何正确地对他下达指令。我不能再用自然语言随便跟他聊天了，我需要一种更严谨的沟通方式——提示词工程（Prompt Engineering）。

我坐在火堆旁，翻开笔记，开始分析 Friday 的"大脑构造"。

### 1. 为什么他会有幻觉？（Transformer 的原理）

Friday 的大脑核心是 Transformer 架构。简单来说，他是在做一道概率题：根据前面的词，预测下一个词是什么。

- 当我说"红色的蘑菇"，他的神经网络激活了关于"马里奥"、"童话故事"和"植物图鉴"的连接。
- 如果"童话故事"的权重占了上风，他就会编造出"能量菇"。

### 2. 提示词（Prompt）：约束幻觉的咒语

既然我无法改变 Friday 的训练数据（我也没法在荒岛上重新训练他），我唯一能控制的，就是输入给他的上下文（Input Context）。

**Prompt 不仅仅是问题，它是约束条件。**

**❌ 错误的指令（会导致幻觉）**：

```python
user_input = "Friday，这蘑菇能吃吗？"
# Friday 的反应：自由发挥，可能会为了迎合我而编造答案。
```

**✅ 正确的指令（Prompt Engineering）**：

我需要设计一个结构化的 Prompt，像给野人戴上"紧箍咒"一样约束他的生成范围。

```python
# 结构化 Prompt 的伪代码
system_prompt = """
你是一名【严谨的植物学家】（角色设定）。
你的任务是判断植物的安全性。
请遵循以下规则（约束条件）：
1. 仅根据事实回答，不要编造。
2. 如果你不确定，必须回答"我不知道"，严禁瞎猜。
3. 如果植物颜色鲜艳，优先警告有毒。
"""

user_input = "前面有一株红色的、有斑点的蘑菇。"
response = llm.generate(system_prompt + user_input)
```

---

## 💻 开发者日志：第一次成功"施法"

我决定立刻测试我的理论。我站起身，再次指着那株毒蘑菇，但这次我换了一套说辞。

我深吸一口气，不再像朋友一样闲聊，而是像写代码一样对他发出了一串严密的指令（Prompt）：

"Friday，进入安全模式。现在的身份：生存专家。任务：风险评估。对象：红色斑点蘑菇。规则：如果是剧毒，输出红色警报；若数据不足，禁止通过。现在，告诉我这是什么？"

Friday 的眼神变了。原本那种浪漫主义的迷离消失了，取而代之的是一种机械的冷静。

他扫描了蘑菇，身体僵硬了一下，然后机械地吐出几个字：

"警告。特征匹配：毒蝇鹅膏。含有神经毒素。建议：立即远离。"

成功了！

通过**角色设定（Role-playing）和思维链（Chain of Thought）**的约束，我成功压制了他的幻觉。

在《从零开始构建智能体》的教程中，这一步至关重要。大部分人认为 Agent 就是把问题扔给 LLM，但真正的开发者知道，Prompt Engineering 是构建 Agent 大脑皮层的第一层防火墙。

没有这层防火墙，Agent 做出的任何决策（比如联网买票、删除文件）都可能是灾难性的。

---

夜深了，我看着正在用沙子练习写字的 Friday。他虽然还是那个爱胡说八道的家伙，但我已经掌握了让他"闭嘴并思考"的开关。

但这还不够。Friday 现在的表现依然是被动的。如果我不问，他就不会动。

下一章，我必须教会他如何主动解决问题——让他学会像人类一样拆解任务。
